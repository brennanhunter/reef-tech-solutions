"use client";
import { motion, useInView } from 'framer-motion';
import { useRef, useState } from 'react';
import Modal from '../ui/Modal';

interface Brand { name: string; logo?: string; }
interface Product { name: string; description: string; }
interface Category { id: string; title: string; brands?: Brand[]; products?: Product[]; blurb?: string; image?: string; }

const categories: Category[] = [
  {
    id: 'lighting',
    title: 'Premium Electrical & Lighting Services',
    image: '/photos/services/Lighting.jpg',
    brands: [{ name: 'Leviton' }, { name: 'Lutron' }],
    blurb: 'For the demanding environment of luxury properties, you need electrical work that is both flawless and durable. We use only premium-grade components from respected brands, such as Leviton, known for their reliability and long-lasting performance. We also specialize in implementing advanced lighting and automation solutions from Lutron, a global leader in high-end control systems.\n\nBy combining the trusted durability of brands like Leviton with the sophisticated controls and automation of Lutron, we ensure that every upgrade, from switches and outlets to intelligent lighting and automated shades, is safe, reliable, and a perfect match for your property\'s quality standards. Whether we\'re performing routine maintenance or installing a complete, energy-efficient system, our work is designed to enhance both the guest experience and your operational efficiency, all while preserving the integrity of your property\'s luxurious design.'
  },
  {
    id: 'maglocks',
    title: 'Magnetic Locks',
    image: '/photos/services/Security.jpg',
    brands: [{ name: 'Allegion' }, { name: 'Maglocks.com' }, { name: 'Cobra Controls' }],
    products: [
      { name: 'Allegion Shear Lock Series', description: 'Premium electromagnetic locks for high-security applications.' },
      { name: 'Cobra Controls Surface Mount Maglocks', description: 'Streamlined installation for various door types.' }
    ]
  },
  {
    id: 'sauna',
    title: 'Sauna & Spa Maintenance',
    image: '/photos/services/Sauna.jpg',
    brands: [{ name: 'Sunlighten' }, { name: 'Plunge' }],
    products: [
      { name: 'Sunlighten Infrared Saunas', description: 'Wellness-focused installations for residential and commercial spaces.' },
      { name: 'Plunge Cold Therapy Systems', description: 'State-of-the-art recovery solutions for spas and fitness facilities.' }
    ]
  },
  {
    id: 'rental',
    title: 'Vacation Rental & Property Management Solutions',
    image: '/photos/services/VacationRental.jpg',
    blurb: 'Comprehensive automation systems for lighting, locks, climate control, and remote monitoring. Maintenance-friendly installations designed for guest turnover efficiency.'
  }
];

export default function ServicesSection() {
  const [openModal, setOpenModal] = useState<string | null>(null);
  return (
    <section id="services" className="py-28 bg-gradient-to-br from-white via-gray-50 to-slate-100 relative overflow-hidden">
      <BackgroundPattern />
      <div className="container mx-auto px-4 relative z-10">
        <HeaderIntro />
        <div className="space-y-24">
          {categories.map((cat, idx) => (
            <CategoryBlock key={cat.id} category={cat} index={idx} onOpen={() => setOpenModal(cat.id)} />
          ))}
        </div>
      </div>

      {/* Lighting / Electrical Modal */}
      <Modal
        open={openModal === 'lighting'}
        onClose={() => setOpenModal(null)}
        title="Reliable Electrical Solutions with Leviton"
        labelledBy="lighting-modal-title"
        id="service-modal-lighting"
      >
        <div className="space-y-6 text-slate-700">
          <p>In a luxury setting, every detail matters—especially those behind the scenes. We choose to work with Leviton because they are the industry standard for safe, reliable, and innovative electrical products. When we install a Leviton component, you&apos;re not just getting a functional part; you&apos;re getting a solution built with durability, advanced safety, and superior aesthetics in mind.</p>
          <p>We frequently install Leviton&apos;s top-tier products, including:</p>
          <ul className="list-disc pl-5 space-y-3">
            <li><strong>Leviton Decora® Smart Wi-Fi Dimmers:</strong> Intelligent dimmers that let you set the perfect ambiance for any space. Control via app, voice, or wall switch—ideal for creating consistent guest-ready lighting scenes.</li>
            <li><strong>Leviton Tamper-Resistant Outlets:</strong> Internal shutter mechanisms block foreign objects unless a proper plug is inserted, adding a discreet layer of guest safety in rooms and shared areas.</li>
            <li><strong>Leviton USB Charger Outlets:</strong> Integrated USB ports eliminate the need for bulky adapters, giving guests convenient charging for phones, tablets, and wearables—the kind of subtle upgrade that noticeably improves experience.</li>
          </ul>
          <p>By integrating these and other Leviton products into our work, we guarantee that your electrical systems are not only up to code but also equipped to provide lasting performance, safety, and a touch of modern convenience that guests will appreciate.</p>
        </div>
      </Modal>
    </section>
  );
}

function HeaderIntro() {
  return (
    <div className="max-w-4xl mx-auto text-center mb-24">
      <h2 className="text-4xl md:text-6xl font-bold tracking-tight mb-6">
        <span className="bg-gradient-to-r from-teal-600 via-cyan-600 to-lime-500 bg-clip-text text-transparent">ReefTech Service Spectrum</span>
      </h2>
      <p className="text-xl md:text-2xl text-gray-600 leading-relaxed">
        Tailored technology and maintenance expertise — focused, brand-aligned, outcome driven.
      </p>
    </div>
  );
}

function CategoryBlock({ category, index, onOpen }: { category: Category; index: number; onOpen: () => void }) {
  const ref = useRef<HTMLDivElement | null>(null);
  const inView = useInView(ref, { once: true, margin: '-80px' });
  const isLighting = category.id === 'lighting';

  return (
    <motion.div
      ref={ref}
      initial={{ opacity: 0, y: 40 }}
      animate={inView ? { opacity: 1, y: 0 } : {}}
      transition={{ duration: 0.8, ease: 'easeOut', delay: index * 0.1 }}
      className="relative"
    >
      <div className="relative bg-white/70 backdrop-blur-sm border border-cyan-100 rounded-3xl p-10 shadow-[0_10px_40px_-10px_rgba(0,0,0,0.08)] hover:shadow-[0_15px_50px_-10px_rgba(0,0,0,0.12)] transition-shadow overflow-hidden">
        {isLighting && (
          <div className="hidden lg:flex flex-col gap-3 absolute inset-y-6 right-6 w-[340px] xl:w-[380px]">
            <div className="relative flex-1 overflow-hidden rounded-xl shadow-md group">
              {/* eslint-disable-next-line @next/next/no-img-element */}
              <img src="/photos/brand-pictures/leviton-lights.webp" alt="Leviton lighting installation" className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" loading="lazy" />
              <div className="absolute inset-0 bg-gradient-to-t from-black/55 via-black/0 to-transparent opacity-70 group-hover:opacity-50 transition-opacity" />
              <div className="absolute top-2 left-2 bg-white/85 backdrop-blur-sm rounded-md px-1.5 py-1 shadow ring-1 ring-white/60">
                {/* eslint-disable-next-line @next/next/no-img-element */}
                <img src="/photos/brand-icons/leviton-logo.svg" alt="Leviton logo" className="h-5 w-auto" loading="lazy" />
              </div>
            </div>
            <div className="relative flex-1 overflow-hidden rounded-xl shadow-md group">
              {/* eslint-disable-next-line @next/next/no-img-element */}
              <img src="/photos/brand-pictures/lutron-lights.webp" alt="Lutron lighting system" className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" loading="lazy" />
              <div className="absolute inset-0 bg-gradient-to-t from-black/55 via-black/0 to-transparent opacity-70 group-hover:opacity-50 transition-opacity" />
              <div className="absolute top-2 left-2 bg-white/85 backdrop-blur-sm rounded-md px-1.5 py-1 shadow ring-1 ring-white/60">
                {/* eslint-disable-next-line @next/next/no-img-element */}
                <img src="/photos/brand-icons/lutron-logo.svg" alt="Lutron logo" className="h-5 w-auto" loading="lazy" />
              </div>
            </div>
            <span className="absolute bottom-0 left-0 translate-y-full ml-1 text-[11px] tracking-wide font-semibold text-slate-700 bg-white/80 px-2 py-0.5 rounded-full backdrop-blur-sm shadow">
              {index + 1}
            </span>
          </div>
        )}
        <div className={`relative ${isLighting ? 'lg:pr-[360px] xl:pr-[400px]' : ''}`}>
          <h3 className="text-2xl md:text-3xl font-bold mb-4 tracking-tight">
            <span className="bg-gradient-to-r from-teal-600 via-cyan-600 to-lime-500 bg-clip-text text-transparent">
              {category.title}
            </span>
          </h3>
          {category.brands && (
            <div className="flex flex-wrap items-center gap-2 mb-6">
              {category.brands.map(b => (
                <BrandBadge key={b.name} brand={b} />
              ))}
            </div>
          )}
          {category.blurb && (
            <div className="text-lg text-gray-600 leading-relaxed space-y-5">
              {category.blurb.split(/\n\n+/).map((para, i) => (
                <p key={i}>{para}</p>
              ))}
            </div>
          )}
          {category.products && !category.blurb && (
            <ul className="space-y-4">
              {category.products.map(prod => (
                <li key={prod.name} className="group">
                  <div className="flex flex-col sm:flex-row sm:items-baseline sm:gap-3">
                    <span className="font-semibold text-gray-800 group-hover:text-teal-600 transition-colors">
                      {prod.name}
                    </span>
                    <span className="text-gray-500 text-sm hidden sm:inline">—</span>
                    <p className="text-gray-600 text-sm md:text-base leading-relaxed flex-1">
                      {prod.description}
                    </p>
                  </div>
                </li>
              ))}
            </ul>
          )}
          <div className="mt-8">
            <button
              type="button"
              onClick={onOpen}
              className="inline-flex items-center gap-2 px-5 py-2.5 rounded-full text-sm font-semibold bg-gradient-to-r from-teal-600 to-cyan-600 text-white shadow hover:from-teal-500 hover:to-cyan-500 focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-offset-2 focus:ring-offset-white transition disabled:opacity-50"
            >
              Read More
              <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M5 12h14" /><path d="M13 6l6 6-6 6" /></svg>
            </button>
          </div>
        </div>
        {!isLighting && (
          <div className="hidden lg:flex w-64 flex-none items-center justify-center">
            {category.image ? (
              <div className="relative w-full h-48 overflow-hidden rounded-2xl shadow-lg group">
                {/* eslint-disable-next-line @next/next/no-img-element */}
                <img
                  src={category.image}
                  alt={category.title + ' representative image'}
                  className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                  loading="lazy"
                />
                <div className="absolute inset-0 bg-gradient-to-t from-black/40 via-black/0 to-transparent opacity-60 group-hover:opacity-40 transition-opacity" />
                <span className="absolute bottom-2 left-3 text-[11px] tracking-wide font-semibold text-white/90 bg-black/30 px-2 py-0.5 rounded-full backdrop-blur-sm">
                  {index + 1}
                </span>
              </div>
            ) : (
              <div className="w-full h-48 rounded-2xl bg-gradient-to-br from-cyan-50 to-lime-50 border border-cyan-100 flex items-center justify-center text-cyan-600 text-sm font-medium tracking-wide">
                Category {index + 1}
              </div>
            )}
          </div>
        )}
        <div className="pointer-events-none absolute inset-0 rounded-3xl ring-1 ring-transparent hover:ring-cyan-300/40 transition-all duration-500" />
      </div>
    </motion.div>
  );
}

function BrandBadge({ brand }: { brand: Brand }) {
  return (
    <span className="px-3 py-1 rounded-full bg-gradient-to-r from-cyan-500/10 via-teal-500/10 to-lime-500/10 border border-cyan-300/30 text-[11px] font-semibold tracking-wide text-cyan-700 shadow-[0_0_0_3px_rgba(6,182,212,0.08)]">
      {brand.name}
    </span>
  );
}

function BackgroundPattern() {
  return (
    <div className="pointer-events-none absolute inset-0 opacity-[0.06] [mask-image:radial-gradient(circle_at_center,black,transparent)]">
      <svg className="w-full h-full" viewBox="0 0 400 400" aria-hidden="true">
        <defs>
          <pattern id="svc-grid" width="40" height="40" patternUnits="userSpaceOnUse">
            <path d="M40 0H0V40" fill="none" stroke="#0ea5e9" strokeWidth="0.5" />
          </pattern>
        </defs>
        <rect width="400" height="400" fill="url(#svc-grid)" />
      </svg>
    </div>
  );
}
